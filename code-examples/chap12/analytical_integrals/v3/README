Eliminating branches, adjusting iterations, and other optimizations at Python level

